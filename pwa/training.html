<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å‘¼å¸ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>
  <link rel="stylesheet" href="style.css" />

  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="img/icon-192.png">
</head>
<body>
  <div class="container">
    <h1 id="top-title">ã‚¦ãƒ«ãƒˆãƒ©ãƒ–ãƒ¬ã‚¹</h1>
    <img src="img/ultrabreath.jpg" alt="Ultrabreath ãƒ­ã‚´" id="logo-image" />

    <div id="training-screen">
      <div id="nfc-banner" style="display:none; background:#e8f5e9; color:#2e7d32; padding:8px; border-radius:6px; margin:8px 0;">
        NFCã‹ã‚‰èµ·å‹•ã—ã¾ã—ãŸã€‚æº–å‚™OKï¼
      </div>

      <p id="streak-info">ä»Šæ—¥ã§0æ—¥é€£ç¶šã§ã™ï¼</p>
      <div id="character">
        <img alt="ãƒ–ãƒ¬ã‚¹å…ˆç”Ÿ" id="character-image" src="img/normal.png" />
        <div id="nickname-display" style="font-weight: bold; font-size: 1.1em; margin: 6px;"></div>
        <p id="speech">ã¯ã˜ã‚ã¾ã—ã‚‡ã†ã‹ã€æ·±å‘¼å¸ã§ã™ã‚ˆã€‚</p>
      </div>
      <div>
        <p>å‘¼å¸å›æ•°ï¼š<span id="breath-count">0</span></p>
        <div id="button-group">
          <button class="main-button" id="breathe-button" onclick="countBreath()">å¸ã£ãŸï¼</button>
          <button class="main-button" id="back-button" onclick="goBack()">â† ãƒˆãƒƒãƒ—ç”»é¢ã«æˆ»ã‚‹</button>
          <button class="main-button" id="retry-button" style="display: none;" onclick="resetTraining()">ã‚‚ã†ä¸€åº¦</button>
        </div>
      </div>

      <div id="log">
        <h2>è¨˜éŒ²</h2>
        <p>ä»Šæ—¥ã®å‘¼å¸å›æ•°ï¼š<span id="today-count">0</span></p>
        <p>ä»Šæ—¥ã®ã‚»ãƒƒãƒˆå›æ•°ï¼š<span id="today-set">0</span> ã‚»ãƒƒãƒˆ</p>
        <p>æœ€çµ‚å®Ÿæ–½æ—¥ï¼š<span id="last-date">ãªã—</span></p>
      </div>

      <div id="goal-progress-container" style="margin-top: 16px;">
        <p style="margin-bottom: 6px;">ğŸ¯ ä»Šæ—¥ã®ç›®æ¨™é”æˆåº¦</p>
        <div id="goal-bar-bg" style="width: 100%; max-width: 320px; height: 20px; background: #ddd; border-radius: 10px; margin: auto;">
          <div id="goal-bar" style="height: 100%; width: 0%; background: linear-gradient(to right, #4caf50, #8bc34a); border-radius: 10px; transition: width 0.6s ease;"></div>
        </div>
        <p id="goal-percent" style="margin-top: 6px;">0%</p>
      </div>
      <button class="main-button" id="send-mail-btn" style="margin-bottom: 10px;">ä»Šæ—¥ã®è¨˜éŒ²ã‚’ãƒ¡ãƒ¼ãƒ«ã§é€ã‚‹</button>
      <button class="main-button" onclick="location.href='calendar.html'">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’è¦‹ã‚‹</button>
    </div>
  </div>

  <script src="training.js"></script>
  <script>
    function goBack() {
      location.href = 'index.html';
    }

    document.addEventListener("DOMContentLoaded", () => {
      startTraining();
    });
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('./sw.js').catch(function(e){ console.log('SW reg failed', e); });
      });
    }
  </script>

  <script>
    (function(){
      const params = new URLSearchParams(location.search);
      if (params.get('via') === 'nfc') {
        const b = document.getElementById('nfc-banner');
        if (b) b.style.display = 'block';
      }
    })();
  </script>

</body>
</html>